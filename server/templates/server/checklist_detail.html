{% extends 'server/base.html' %}

{% block header %}
{% endblock %}

{% block main %}
<div class='container ms-2 me-0 mt-3 mb-4'>
<div class='row justify-content-start'>
    <div class='col-3 me-0'>
        <div class='sticky-top'>
            <div class='row'>
                <div class='col'>
                    <label for='checklist-template-toc' class='h5 mt-5'>Sections</label>
                    <div id='checklist-template-toc' class='list-group'>
                        {% for section, questions_and_fields in sections_and_questions.items %}
                        <a class='list-group-item list-group-item-action' href='#section_{{ forloop.counter }}'>
                            {{ forloop.counter }}: {{ section }}
                        </a>
                        {% endfor %}
                    </div>
                </div>
            </div>
            <div class='row mt-3'>
                <div class='col'>
                    <h5>Checklist Template Information</h5>
                    <h6>
                        Maintainer:
                        <a class='link-opacity-100' href='#'>
                            {{ checklist_template.ChecklistTemplateMaintainer.ChecklistTemplateMaintainerName_Value }}
                        </a>
                    </h6>
                    <h6>
                        Version: {{ checklist_template.ChecklistTemplateVersion_Value }}
                    </h6>
                    <h6>
                        Tags:
                        {% for tag in checklist_template.Tags.all %}
                            <a href='#' class='badge text-bg-primary'>{{ tag.Value }}</a>
                        {% endfor %}
                    </h6>
                    <h6>
                        Description: {{ checklist_template.Description_Value }}
                    </h6>
                </div>
            </div>
        </div>
    </div>
    <div class='col-9'>
        <div class='row'>
            <div class='col-7'>
                <h1 class='h3'>
                    Checklist Template:
                    <button class="btn btn-outline-primary btn-lg dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false">
                        {{ checklist_template.ChecklistTemplateName_Value }}
                    </button>
                    <ul class="dropdown-menu">
                        {% for checklist_template_name, checklist_template_id in other_checklist_templates %}
                        <li>
                            <a
                                class='dropdown-item {% if checklist_template_name == checklist_template.ChecklistTemplateName_Value %}active{% endif %}'
                                href='{% url 'detail' checklist_template_id %}'
                                {% if checklist_template_name == checklist_template.ChecklistTemplateName_Value %}aria-current='true'{% endif %}
                                >
                                {{ checklist_template_name }}
                            </a>
                        </li>
                        {% endfor %}
                    </ul>
                </h1>
            </div>
            <div class='col text-end'>
                <button type='button' class='btn btn-warning btn-lg ms-5'>
                    <i class='bi bi-download'></i> Download OB JSON
                </button>
            </div>
        </div>
        {% for section, questions_and_fields in sections_and_questions.items %}
        <div class='row'>
            <div class='col'>
                <h5 style='margin-bottom: 0rem; margin-top: .5rem'>
                    Section {{ forloop.counter }}: {{ section }}
                </h5>
                <hr style='margin-top: 0rem'>
            </div>
        </div>
        {% with section_counter=forloop.counter %}
        <div class='row' id='section_{{ forloop.counter }}'>
            <div class='col'>
                {% for question, field in questions_and_fields %}
                <div class='row gx-5 px-4 justify-content-start'>
                    <div class='col'>
                        <button
                            class='btn btn-outline-primary dropdown-toggle checklist-template-question-label-collapse-btn'
                            for='{{ field.id_for_label }}'
                            data-bs-toggle='collapse'
                            href='#collapse-{{ field.id_for_label }}'
                            aria-expanded='false' aria-controls='collapse-{{ field.id_for_label }}'
                        >
                            {{ section_counter }}.{{ forloop.counter|stringformat:'02d' }}: {{ question.QuestionLabel_Value }}
                        </button>
                            <div class='collapse' id='collapse-{{ field.id_for_label}}'>
                            <div class='card card-body'>
                                {{ question.QuestionHelp_Value }}
                            </div>
                        </div>
                    </div>
                    <div class='col'>
                        <div class='input-group'>
                            {{ field }}
                        </div>
                    </div>
                </div>
                {% endfor %}
            </div>
        </div>
        {% endwith %}
        {% endfor %}
    </div>
</div>
</div>
{% endblock %}
